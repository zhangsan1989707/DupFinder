# 智能文件查重工具 (DupFinder)

一款基于图形化界面的智能文件查重工具，支持视频、文本和图片文件的重复检测，能够识别内容相同但经过转码、剪辑、缩放、编辑或格式转换的重复文件。

## 功能特点

- **三模式支持**: 同时支持视频查重、文本查重和图片查重
- **智能识别**: 
  - 视频：使用内容感知哈希技术，超越传统的文件名和大小比较
  - 文本：采用先进的文本相似度算法，支持多种文本格式
  - 图片：基于感知哈希算法，支持不同格式、分辨率和压缩率的图片对比
- **多格式支持**: 
  - 视频：MP4, AVI, MKV, MOV, WMV, FLV 等常见视频格式
  - 文本：TXT, MD, PY, JS, HTML, XML, JSON, CSV 等40多种文本格式
  - 图片：JPG, PNG, BMP, GIF, WEBP 等常见图片格式
- **灵活处理**: 提供多种选择策略和安全的文件处理选项
- **用户友好**: 直观的图形界面，支持拖拽添加路径，模式一键切换
- **安全可靠**: 默认移动到回收站，支持备份功能
- **高性能优化**: 针对大文件和批量处理进行了性能优化

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行应用

```bash
python test_app.py
```

或者直接运行：

```bash
python src/main.py
```

## 使用方法

1. **选择扫描模式**: 在顶部工具栏选择"视频查重"、"文本查重"或"图片查重"模式
2. **添加扫描路径**: 点击"添加路径"按钮或拖拽文件夹到路径列表
3. **调整设置**: 设置相似度阈值（默认80%）
4. **开始扫描**: 点击"开始扫描"按钮
5. **查看结果**: 扫描完成后查看重复文件分组
6. **选择处理**: 使用选择策略或手动选择要保留的文件
7. **执行处理**: 点击"执行处理"按钮处理重复文件

## 选择策略

- **保留最大分辨率**: 自动选择分辨率最高的视频
- **保留最小大小**: 自动选择文件大小最小的视频
- **保留最新文件**: 自动选择修改时间最新的视频
- **保留最旧文件**: 自动选择修改时间最旧的视频
- **手动选择**: 用户自行勾选要保留的文件

## 处理方式

- **移动到回收站**: 默认安全选项，可恢复
- **移动到备份文件夹**: 移动到指定的备份目录
- **永久删除**: 直接删除文件（谨慎使用）

## 技术实现

- **GUI框架**: PyQt5
- **视频处理**: OpenCV
- **图片处理**: PIL/Pillow
- **特征提取**: 感知哈希 (imagehash) 用于视频和图片
- **文本处理**: 多种相似度算法结合
- **文件处理**: send2trash (安全删除)
- **并发处理**: 多线程和多进程优化
- **缓存机制**: 提高重复检测效率

## 项目结构

```
DupFinder/
├── src/
│   ├── main.py              # 应用程序入口
│   ├── gui/                 # GUI组件
│   │   ├── main_window.py   # 主窗口
│   │   └── settings_dialog.py # 设置对话框
│   ├── scanner/             # 文件扫描
│   │   ├── video_scanner.py # 视频文件扫描
│   │   ├── text_scanner.py  # 文本文件扫描
│   │   └── image_scanner.py # 图片文件扫描
│   ├── detector/            # 重复检测
│   │   ├── duplicate_detector.py       # 视频重复检测
│   │   ├── text_duplicate_detector.py  # 文本重复检测
│   │   └── image_duplicate_detector.py # 图片重复检测
│   ├── processor/           # 文件处理
│   │   └── file_processor.py
│   └── utils/               # 工具类
│       └── config.py        # 配置管理
├── requirements.txt         # 依赖列表
├── test_app.py              # 测试启动脚本
├── test_performance.py      # 性能测试脚本
├── test_text_detection.py   # 文本检测测试脚本
├── test_texts/              # 测试文本文件
├── test_texts_large/        # 大型测试文本文件
└── README.md                # 说明文档
```

## 系统要求

- Python 3.7+
- Windows/macOS/Linux
- 足够的内存处理大型视频文件

## 注意事项

- 首次扫描大量视频文件可能需要较长时间
- 建议在处理前备份重要文件
- 相似度阈值设置过低可能产生误判

## 开发计划

- [ ] 添加视频预览功能
- [ ] 支持更多文件格式
- [ ] 优化大文件处理性能
- [ ] 添加批量重命名功能
- [ ] 增强文本比较算法
- [ ] 添加报告导出功能
- [ ] 支持更多选择策略