好的，这是一个基于您提供的工具和需求编写的详细需求文档。

# 视频文件智能查重工具需求文档

## 1. 项目概述

本项目旨在开发一款基于图形化界面（GUI）的视频文件智能查重工具。该工具将综合利用**内容感知哈希**与**机器学习增强比对**技术，超越传统的文件名和大小比较，能够有效识别内容相同但经过转码、剪辑、缩放、编辑或画质差异的重复视频文件。用户可通过界面指定多个扫描路径，工具将输出详细的重复文件分组列表，并支持用户对重复项进行灵活的多选处理操作，旨在帮助用户高效释放存储空间。

## 2. 核心目标

- **精准识别**: 准确识别内容相同或高度相似的视频文件，不受文件名、格式、分辨率或轻微编辑的影响。
- **高效易用**: 提供直观的图形用户界面（GUI），简化操作流程，提升用户体验。
- **灵活处理**: 为用户提供多种选择策略和手动干预能力，安全地管理重复文件。
- **技术整合**: 有效整合并优化 `Video Duplicate Finder (VDF)`和 `Media-Match`等开源项目的核心算法思路。

## 3. 功能需求

### 3.1 扫描配置 (用户输入)

- **多路径支持**: 允许用户通过“添加”按钮或拖拽方式输入多个待扫描的目录或文件路径。
- **路径管理**: 提供列表视图展示所有已添加的路径，并支持移除单个或清空所有路径。
- **格式支持**: 支持常见视频格式（如 `.mp4`, `.avi`, `.mkv`, `.mov`, `.wmv`, `.flv`等）。

### 3.2 查重引擎 (核心处理)

- **混合分析策略**:
  - **元数据预筛**: 初步比较文件大小、时长、分辨率等元数据，快速筛选潜在重复项。
  - **内容特征提取**:
    - 集成类似 **VDF** 的帧签名比较技术，从视频中提取关键帧并生成内容签名。
    - 可选集成类似 **Media-Match** 的感知哈希（Perceptual Hashing）和机器学习模型（如CNN特征提取），进行更精细的相似度计算，以适应更复杂的编辑和压缩场景。
  - **可配置阈值**: 提供“相似度百分比”滑块或输入框（例如50%-100%），允许用户调整判定重复的敏感度。
- **性能优化**:
  - **并行处理**: 利用多线程或异步任务处理，防止UI界面在扫描大型目录时卡顿。
  - **采样策略**: 可配置抽帧频率（如每秒N帧或按时间间隔），以平衡扫描速度和准确性。

### 3.3 结果展示 (输出)

- **分组显示**: 将以分组（Group）形式清晰展示重复文件集。每一组代表一组彼此重复或高度相似的视频。
- **详细信息**: 每组重复文件中，每个文件应显示以下信息：
  - 文件路径
  - 文件名
  - 文件大小
  - 分辨率
  - 时长
  - 相似度百分比
- **预览功能**: 支持选中单个文件后，进行视频预览（可选功能，可优先实现图像快照预览）。
- **排序与过滤**: 支持对结果列表按分组、大小、路径等条件进行排序和过滤。

### 3.4 文件处理 (多选操作)

- **选择策略**: 在每一组重复文件中，提供便捷的选择方式：
  - **按钮策略**: “保留最大分辨率”、“保留最小大小”、“保留最新文件”、“保留最旧文件”。
  - **手动选择**: 用户可自行勾选每组中希望保留的文件（默认可自动选择策略推荐的一个）。
- **操作执行**:
  - 提供“执行删除”或“移动”按钮，对用户**未选择**的所有文件（即待处理文件）进行操作。
  - **安全措施**: 重要操作前应弹出确认对话框。建议默认将文件移至“系统回收站”或指定的“备份文件夹”，而非直接永久删除。
  - 显示处理进度和最终摘要（例如：“成功移动了15个文件，释放了2.1GB空间”）。

### 3.5 用户界面 (UI)

- **主界面布局**: 设计应简洁明了，建议包含以下区域：
  - **顶部工具栏**: “添加路径”、“开始扫描”、“停止扫描”、“设置”按钮。
  - **路径列表区**: 显示已添加的扫描路径。
  - **中间状态区**: 进度条、当前扫描文件、预计剩余时间。
  - **底部结果区**: 选项卡或分组列表形式展示重复文件组。
  - **底部操作区**: 全局选择策略下拉菜单、“执行处理”按钮。
- **设置面板**:
  - 相似度阈值调整。
  - 抽帧/采样频率设置。
  - 文件处理方式（永久删除、移至回收站、移动到指定文件夹）。
  - 忽略小于特定大小或时长的文件。

## 4. 非功能需求

- **准确性**: 在默认阈值下，对内容相同的视频（即使有画质差异）应具备高召回率和精确率。
- **性能**: 扫描速度应优化，对于大量视频文件（如数TB），需提供进度反馈且不应阻塞UI。
- **资源占用**: 运行时CPU和内存占用应合理，避免影响用户同时进行其他工作。
- **兼容性**: 支持 Windows、macOS 和 Linux 等主流操作系统（跨平台）。
- **用户体验**: 界面响应迅速，交互逻辑清晰，提供必要的状态提示和错误信息。

## 5. 技术方案建议

### 5.1 技术栈

| 组件              | 推荐选择                                                     | 说明                                                         |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **编程语言**      | **Python**                                                   | 生态丰富，易于集成计算机视觉和机器学习库，跨平台支持良好。   |
| **GUI框架**       | **PyQt/PySide** 或 **Tkinter**                               | PyQt/PySide功能强大界面美观；Tkinter为Python标准库，更轻量。 |
| **核心计算库**    | **OpenCV**                                                   | 视频解码、抽帧、图像处理。                                   |
| **感知哈希/特征** | **`videohash`** (或其算法思想), **`imagehash`**              | 生成视频/图像哈希。                                          |
| **机器学习**      | **TensorFlow / PyTorch** (若需深度特征)                      | 提供预训练模型（如EfficientNet, VGG）用于提取帧特征，实现高精度匹配（参考Media-Match思路）。 |
| **多媒体处理**    | **FFmpeg** (可通过 `subprocess`调用或使用 `ffmpeg-python`等绑定库) | 强大的视频处理后端，支持广泛格式。                           |
| **其他工具库**    | **NumPy** (数值计算), **Pillow** (图像处理)                  | 基础支持。                                                   |

### 5.2 系统架构与流程

```
graph TD
    A[用户通过UI添加多个路径] --> B[系统递归扫描路径下视频文件]
    B --> C[元数据快速预筛<br>生成候选重复对]
    C --> D[对候选集进行内容特征提取<br>抽帧 -> 计算感知哈希/深度学习特征]
    D --> E[计算视频间特征相似度]
    E --> F{相似度 > 阈值?}
    F -->|是| G[归入同一重复组]
    F -->|否| H[标记为独立文件]
    G --> I[在UI中分组展示结果]
    H --> I
    I --> J[用户选择处理方式<br>手动多选或应用策略]
    J --> K[执行用户指令<br>移动或删除未选项]
    K --> L[向用户反馈处理结果]
```

## 6. 未来发展（可选）

- **图片查重**: 扩展功能以支持重复图片文件的查找。
- **更智能的推荐**: 利用机器学习模型预测用户最可能保留的文件版本。

## 7. 风险与缓解

- **误删风险**: 通过“回收站”或“备份文件夹”机制缓解，并提供明确的操作确认。
- **性能瓶颈**: 对于超大规模视频库，提供更灵活的抽帧和采样配置选项。
- **复杂编辑的识别**: 极度复杂的编辑（如大幅裁剪、混剪）可能超出感知哈希能力，需依赖更高级的机器学习模型。

------

*Version: 1.1

*Date: 2025-09-11*